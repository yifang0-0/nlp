<article class="post-2964 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
	<header>
	<h1 class="title entry-title">Text Generation With LSTM Recurrent Neural Networks in Python with Keras</h1>	</header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" title="Posts by Jason Brownlee" rel="author">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2016-08-04T05:00:46+1000">August 4, 2016</abbr>  <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Deep Learning for Natural Language Processing">Deep Learning for Natural Language Processing</a></span>  </div>
	<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-2964 post  simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=Text+Generation+With+LSTM+Recurrent+Neural+Networks+in+Python+with+Keras&amp;url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" rel="nofollow" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72"><path fill="none" d="M0 0h72v72H0z"></path><path class="icon" fill="#fff" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
		<button class="ssb_fbshare-icon" target="_blank" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="_1pbq" color="#ffffff"><path fill="#ffffff" fill-rule="evenodd" class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z"></path></svg></span>
						<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"> <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="15px" height="14.1px" viewBox="-301.4 387.5 15 14.1" enable-background="new -301.4 387.5 15 14.1" xml:space="preserve"> <g id="XMLID_398_"> <path id="XMLID_399_" fill="#FFFFFF" d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z"></path> <path id="XMLID_400_" fill="#FFFFFF" d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z"></path> <path id="XMLID_401_" fill="#FFFFFF" d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z"></path> </g> </svg> </span>
						<span class="simplesocialtxt">Share</span> </button>
</div>
<p id="last-modified-info">Last Updated on September 3, 2020</p><p>Recurrent neural networks can also be used as generative models.</p>
<p>This means that in addition to being used for predictive models (making predictions) they can learn the sequences of a problem and then generate entirely new plausible sequences for the problem domain.</p>
<p>Generative models like this are useful not only to study how well a model has learned a problem, but to learn more about the problem domain itself.</p>
<p>In this post you will discover how to create a generative model for text, character-by-character using LSTM recurrent neural networks in Python with Keras.</p>
<p>After reading this post you will know:</p>
<ul>
<li>Where to download a free corpus of text that you can use to train text generative models.</li>
<li>How to frame the problem of text sequences to a recurrent neural network generative model.</li>
<li>How to develop an LSTM to generate plausible text sequences for a given problem.</li>
</ul>
<p><strong>Kick-start your project</strong> with my new book <a href="https://machinelearningmastery.com/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a>, including <em>step-by-step tutorials</em> and the <em>Python source code</em> files for all examples.</p>
<p>Let’s get started.</p>
<p><strong>Note</strong>: LSTM recurrent neural networks can be slow to train and it is highly recommend that you train them on GPU hardware. You can access GPU hardware in the cloud very cheaply using Amazon Web Services, <a href="http://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/">see the tutorial here</a>.</p>
<ul>
<li><strong>Update Oct/2016</strong>: Fixed a few minor comment typos in the code.</li>
<li><strong>Update Mar/2017</strong>: Updated for Keras 2.0.2, TensorFlow 1.0.1 and Theano 0.9.0.</li>
<li><strong>Update Sep/2019</strong>: Updated for Keras 2.2.5 API.</li>
</ul>
<div id="attachment_2965" style="width: 650px" class="wp-caption aligncenter"><img aria-describedby="caption-attachment-2965" loading="lazy" class="size-full wp-image-2965" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/Text-Generation-With-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" alt="Text Generation With LSTM Recurrent Neural Networks in Python with Keras" width="640" height="426" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/Text-Generation-With-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/Text-Generation-With-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-300x200.jpg 300w" sizes="(max-width: 640px) 100vw, 640px"><p id="caption-attachment-2965" class="wp-caption-text">Text Generation With LSTM Recurrent Neural Networks in Python with Keras<br>Photo by <a href="https://www.flickr.com/photos/tearstone/5028273685/">Russ Sanderlin</a>, some rights reserved.</p></div>
<h2>Problem Description: Project Gutenberg</h2>
<p>Many of the classical texts are no longer protected&nbsp;under copyright.</p>
<p>This means that you can download all of the text for these books for free and use them in experiments, like creating generative models.&nbsp;Perhaps the best place to get access to free&nbsp;books that are no longer protected by copyright is <a href="https://www.gutenberg.org">Project Gutenberg</a>.</p>
<p>In this tutorial we are going to use a&nbsp;favorite book from childhood as the dataset: <a href="https://www.gutenberg.org/ebooks/11">Alice’s Adventures in Wonderland by Lewis Carroll</a>.</p>
<p>We are going to learn the dependencies between characters and the conditional probabilities of characters in sequences so that we can in turn generate wholly new and original sequences of characters.</p>
<p>This is a lot of fun and I recommend repeating these experiments with other books from Project Gutenberg, <a href="https://www.gutenberg.org/ebooks/search/%3Fsort_order%3Ddownloads">here is a list of the most popular books on the site</a>.</p>
<p>These experiments are not limited to text, you can also experiment with other ASCII data, such as computer source code, marked up documents in LaTeX, HTML or Markdown and more.</p>
<p>You can <a href="http://www.gutenberg.org/cache/epub/11/pg11.txt">download the complete text in ASCII format</a> (Plain Text UTF-8) for this book for free and place it in your working directory with the filename <strong>wonderland.txt</strong>.</p>
<p>Now we need to prepare the dataset ready for modeling.</p>
<p>Project Gutenberg adds a standard header and footer to each book and this is not part of the original text. Open the file in a text editor and delete the header and footer.</p>
<p>The header is obvious and ends with the text:</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeed9055644371" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">*** START OF THIS PROJECT GUTENBERG EBOOK ALICE'S ADVENTURES IN WONDERLAND ***</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeed9055644371-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeed9055644371-1">*** START OF THIS PROJECT GUTENBERG EBOOK ALICE'S ADVENTURES IN WONDERLAND ***</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The footer is all of the text after the line of text that says:</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeede875933909" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">THE END</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeede875933909-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeede875933909-1">THE END</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>You should be left with a text file that has about 3,330 lines of text.</p>
<div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" target="_blank" rel="noopener noreferrer" data-leadbox="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" data-leadbox-id="1403a9373f72a2:164f8be4f346dc">Start Your FREE Mini-Course Now!</a><script data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" data-config="%7B%7D" type="text/javascript" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js"></script></p>
</center>
<div class="woo-sc-hr"></div>
<h2>Develop a Small LSTM Recurrent Neural Network</h2>
<p>In this section we will develop a simple LSTM network to learn sequences of characters from Alice in Wonderland. In the next section we will use this model to generate new sequences of characters.</p>
<p>Let’s start off by importing the classes and functions we intend to use to train our model.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeedf240979508" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils
...</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeedf240979508-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeedf240979508-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeedf240979508-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeedf240979508-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeedf240979508-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeedf240979508-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeedf240979508-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeedf240979508-8">8</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeedf240979508-1"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeedf240979508-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeedf240979508-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeedf240979508-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeedf240979508-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeedf240979508-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeedf240979508-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np</span><span class="crayon-sy">_</span>utils</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeedf240979508-8"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Next, we need to load the ASCII text for the book into memory and convert all of the characters to lowercase to reduce the vocabulary that the network must learn.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee0093272178" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename, 'r', encoding='utf-8').read()
raw_text = raw_text.lower()</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee0093272178-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee0093272178-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee0093272178-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee0093272178-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee0093272178-5">5</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee0093272178-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee0093272178-2"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee0093272178-3"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee0093272178-4"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-o">=</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee0093272178-5"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Now that the book is loaded, we must prepare the data for modeling by the neural network. We cannot model the characters directly, instead we must convert the characters to integers.</p>
<p>We can do this easily by first creating a set of all of the distinct characters in the book, then creating a map of each character to a unique integer.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee1010684238" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
# create mapping of unique chars to integers
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee1010684238-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee1010684238-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee1010684238-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee1010684238-4">4</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee1010684238-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee1010684238-2"><span class="crayon-p"># create mapping of unique chars to integers</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee1010684238-3"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee1010684238-4"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>For example, the list of unique sorted lowercase characters in the book is as follows:</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee2184880483" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">['\n', '\r', ' ', '!', '"', "'", '(', ')', '*', ',', '-', '.', ':', ';', '?', '[', ']', '_', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '\xbb', '\xbf', '\xef']</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee2184880483-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee2184880483-1">['\n', '\r', ' ', '!', '"', "'", '(', ')', '*', ',', '-', '.', ':', ';', '?', '[', ']', '_', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '\xbb', '\xbf', '\xef']</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>You can see that there may be some characters that we could remove to further clean up the dataset that will reduce the vocabulary and may improve the modeling process.</p>
<p>Now that the book has been loaded and the mapping prepared, we can summarize the dataset.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee3954948363" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee3954948363-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee3954948363-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee3954948363-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee3954948363-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee3954948363-5">5</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee3954948363-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee3954948363-2"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee3954948363-3"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee3954948363-4"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee3954948363-5"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vocab</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Running the code to this point produces the following output.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee4792085736" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">Total Characters:  147674
Total Vocab:  47</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee4792085736-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee4792085736-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee4792085736-1">Total Characters:&nbsp;&nbsp;147674</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee4792085736-2">Total Vocab:&nbsp;&nbsp;47</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that the book has just under 150,000 characters and that when converted to lowercase that there are only 47 distinct characters in the vocabulary for the network to learn. Much more than the 26 in the alphabet.</p>
<p>We now need to define the training data for the network. There is a lot of flexibility in how you choose to break up the text and expose it to the network during training.</p>
<p>In this tutorial we will split the book text up into subsequences with a fixed length of 100 characters, an arbitrary length. We could just as easily split the data up by sentences and pad the shorter sequences and truncate the longer ones.</p>
<p>Each training pattern of the network is comprised of 100 time steps of one character (X) followed by one character output (y). When creating these sequences, we slide this window along the whole book one character at a time, allowing each character a chance to be learned from the 100 characters that preceded it (except the first 100 characters of course).</p>
<p>For example, if the sequence length is&nbsp;5 (for simplicity) then the first two training patterns would be as follows:</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee5364355915" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">CHAPT -&gt; E
HAPTE -&gt; R</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee5364355915-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee5364355915-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee5364355915-1">CHAPT -&gt; E</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee5364355915-2">HAPTE -&gt; R</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>As we split up the book into these sequences, we convert the characters to integers using our lookup table we prepared earlier.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee6684601389" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee6684601389-12">12</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-2"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-3"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-4"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-5"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-6"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-7"><span class="crayon-h">	</span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-8"><span class="crayon-h">	</span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-9"><span class="crayon-h">	</span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-10"><span class="crayon-h">	</span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-11"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee6684601389-12"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_patterns</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Running the code to this point shows us that when we split up the dataset into training data for the network to learn that we have just under 150,000 training pattens. This makes sense as excluding the first 100 characters, we have one training pattern to predict each of the remaining characters.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee7556069254" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">Total Patterns: &nbsp;147574</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee7556069254-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee7556069254-1">Total Patterns: &nbsp;147574</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Now that we have prepared our training data we need to transform it so that it is suitable for use with Keras.</p>
<p>First we must transform the list of input sequences into the form <em>[samples, time steps, features]</em> expected by an LSTM network.</p>
<p>Next we need to rescale the integers to the range 0-to-1 to make the patterns easier to learn by the LSTM network that uses the sigmoid activation function by default.</p>
<p>Finally, we need to convert the output patterns (single characters converted to integers) into a one hot encoding. This is so that we can configure the network to predict the probability of each of the 47 different characters in the vocabulary (an easier representation) rather than trying to force it to predict precisely the next character. Each y value is converted into a sparse vector with a length of 47, full of zeros except with a 1 in the column for the letter (integer) that the pattern represents.</p>
<p>For example, when “n” (integer value 31) is one hot encoded it looks as follows:</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee8820403314" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">[ 0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.
  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  1.  0.  0.  0.  0.
  0.  0.  0.  0.  0.  0.  0.  0.]</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee8820403314-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee8820403314-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee8820403314-3">3</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee8820403314-1">[ 0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee8820403314-2">&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;1.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee8820403314-3">&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.&nbsp;&nbsp;0.]</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can&nbsp;implement these steps as below.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeee9767325110" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee9767325110-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee9767325110-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee9767325110-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee9767325110-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee9767325110-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee9767325110-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeee9767325110-7">7</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee9767325110-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee9767325110-2"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee9767325110-3"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee9767325110-4"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee9767325110-5"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeee9767325110-6"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeee9767325110-7"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can now define our LSTM model. Here we define a single hidden LSTM layer with 256 memory units. The network uses dropout with a probability of 20. The output layer is a Dense layer using the softmax activation function to output a probability prediction for each of the 47 characters between 0 and 1.</p>
<p>The problem is really a single character classification problem with 47 classes and as such is defined as optimizing the log loss (cross entropy), here using the ADAM optimization algorithm for speed.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeeea366565274" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2])))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam')</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeea366565274-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeea366565274-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeea366565274-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeea366565274-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeea366565274-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeea366565274-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeea366565274-7">7</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeea366565274-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeea366565274-2"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeea366565274-3"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeea366565274-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeea366565274-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeea366565274-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeea366565274-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>There is no test dataset. We are modeling the entire training dataset to learn the probability of each character in a sequence.</p>
<p>We are not interested in the most accurate (classification accuracy) model of&nbsp;the training dataset. This would be a model that predicts each character in the training dataset perfectly. Instead we are interested in a generalization of the dataset that minimizes&nbsp;the chosen loss function. We are seeking a balance between generalization and overfitting but short of memorization.</p>
<p>The network is slow to train (about 300 seconds per epoch on an Nvidia K520 GPU). Because of the slowness and because of our optimization requirements, we will use model checkpointing to record all of the network weights to file each time an improvement in loss is observed at the end of the epoch. We will use the best set of weights (lowest loss) to instantiate our generative model in the next section.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeeeb908724668" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
# define the checkpoint
filepath="weights-improvement-{epoch:02d}-{loss:.4f}.hdf5"
checkpoint = ModelCheckpoint(filepath, monitor='loss', verbose=1, save_best_only=True, mode='min')
callbacks_list = [checkpoint]</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-5">5</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-2"><span class="crayon-p"># define the checkpoint</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-3"><span class="crayon-v">filepath</span><span class="crayon-o">=</span><span class="crayon-s">"weights-improvement-{epoch:02d}-{loss:.4f}.hdf5"</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-4"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeeb908724668-5"><span class="crayon-v">callbacks_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can now fit our model to the data. Here we use a modest number of 20 epochs and a large batch size of 128&nbsp;patterns.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeeec304153187" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">model.fit(X, y, epochs=20, batch_size=128, callbacks=callbacks_list)</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeec304153187-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeec304153187-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-v">callbacks_list</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The full code listing is provided below for completeness.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeeed226810819" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;"># Small LSTM Network to Generate Text for Alice in Wonderland
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename, 'r', encoding='utf-8').read()
raw_text = raw_text.lower()
# create mapping of unique chars to integers
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))
# summarize the loaded data
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2])))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam')
# define the checkpoint
filepath="weights-improvement-{epoch:02d}-{loss:.4f}.hdf5"
checkpoint = ModelCheckpoint(filepath, monitor='loss', verbose=1, save_best_only=True, mode='min')
callbacks_list = [checkpoint]
# fit the model
model.fit(X, y, epochs=20, batch_size=128, callbacks=callbacks_list)</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-38">38</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-39">39</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-40">40</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-41">41</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-42">42</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-43">43</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-44">44</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-45">45</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-46">46</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-47">47</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-48">48</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeed226810819-49">49</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-1"><span class="crayon-p"># Small LSTM Network to Generate Text for Alice in Wonderland</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np</span><span class="crayon-sy">_</span>utils</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-9"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-10"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-11"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-o">=</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-12"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-13"><span class="crayon-p"># create mapping of unique chars to integers</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-14"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-15"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-16"><span class="crayon-p"># summarize the loaded data</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-17"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-18"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-19"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-20"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">_</span>vocab</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-21"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-22"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-23"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-24"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-25"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-26"><span class="crayon-h">	</span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-27"><span class="crayon-h">	</span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-28"><span class="crayon-h">	</span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-29"><span class="crayon-h">	</span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-30"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-31"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">_</span>patterns</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-32"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-33"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-34"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-35"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-36"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-37"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-38"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-39"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-40"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-44"><span class="crayon-p"># define the checkpoint</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-45"><span class="crayon-v">filepath</span><span class="crayon-o">=</span><span class="crayon-s">"weights-improvement-{epoch:02d}-{loss:.4f}.hdf5"</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-46"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-47"><span class="crayon-v">callbacks_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-48"><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeed226810819-49"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-v">callbacks_list</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p></p><p><strong>Note</strong>: Your <a href="https://machinelearningmastery.com/different-results-each-time-in-machine-learning/">results may vary</a> given the stochastic nature of the algorithm or evaluation procedure, or differences in numerical precision. Consider running the example a few times and compare the average outcome.</p>
<p></p>
<p>After running the example, you should have a number of weight checkpoint files in the local directory.</p>
<p>You can delete them all except the one with the smallest loss value. For example, when I ran this example, below was the checkpoint with the smallest&nbsp;loss&nbsp;that I achieved.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeeee692374433" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">weights-improvement-19-1.9435.hdf5</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeee692374433-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeee692374433-1">weights-improvement-19-1.9435.hdf5</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The network loss decreased almost every epoch and I expect the network could benefit from training for many more epochs.</p>
<p>In the next section we will look at using this model to generate new text sequences.</p>
<h2>Generating Text with an&nbsp;LSTM&nbsp;Network</h2>
<p>Generating text using the trained LSTM network is relatively straightforward.</p>
<p>Firstly, we load the data and define the network in exactly the same way, except the network weights are loaded from a checkpoint file and the network does not need to be trained.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeeef066213133" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
# load the network weights
filename = "weights-improvement-19-1.9435.hdf5"
model.load_weights(filename)
model.compile(loss='categorical_crossentropy', optimizer='adam')</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeef066213133-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeef066213133-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeef066213133-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeef066213133-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeef066213133-5">5</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeef066213133-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeef066213133-2"><span class="crayon-p"># load the network weights</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeef066213133-3"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"weights-improvement-19-1.9435.hdf5"</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeef066213133-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">load_weights</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeef066213133-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Also, when preparing the mapping of unique characters to integers, we must also create a reverse mapping that we can use to convert the integers back to characters so that we can understand the predictions.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeef0516391250" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
int_to_char = dict((i, c) for i, c in enumerate(chars))</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef0516391250-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef0516391250-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef0516391250-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef0516391250-2"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Finally, we need to actually make predictions.</p>
<p>The simplest way to use the Keras LSTM model to make predictions is to first start off with a seed sequence as input, generate the next character then update the seed sequence to add the generated character on the end and trim off the first character. This process is repeated for as long as we want to predict new characters (e.g. a sequence of 1,000 characters in length).</p>
<p>We can pick a random input pattern as our seed sequence, then print generated characters as we generate them.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeef1384761530" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
# pick a random seed
start = numpy.random.randint(0, len(dataX)-1)
pattern = dataX[start]
print "Seed:"
print "\"", ''.join([int_to_char[value] for value in pattern]), "\""
# generate characters
for i in range(1000):
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(n_vocab)
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	sys.stdout.write(result)
	pattern.append(index)
	pattern = pattern[1:len(pattern)]
print "\nDone."</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef1384761530-18">18</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-2"><span class="crayon-p"># pick a random seed</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-3"><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-4"><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">[</span><span class="crayon-v">start</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-5"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Seed:"</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-6"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-7"><span class="crayon-p"># generate characters</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-8"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-9"><span class="crayon-h">	</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-10"><span class="crayon-h">	</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-11"><span class="crayon-h">	</span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-12"><span class="crayon-h">	</span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-13"><span class="crayon-h">	</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-14"><span class="crayon-h">	</span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-15"><span class="crayon-h">	</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">stdout</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-16"><span class="crayon-h">	</span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">index</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-17"><span class="crayon-h">	</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef1384761530-18"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\nDone."</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>The full&nbsp;code example for generating text using the loaded LSTM model is listed below for completeness.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeef2536065378" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;"># Load LSTM network and generate text
import sys
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename, 'r', encoding='utf-8').read()
raw_text = raw_text.lower()
# create mapping of unique chars to integers, and a reverse mapping
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))
int_to_char = dict((i, c) for i, c in enumerate(chars))
# summarize the loaded data
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2])))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
# load the network weights
filename = "weights-improvement-19-1.9435.hdf5"
model.load_weights(filename)
model.compile(loss='categorical_crossentropy', optimizer='adam')
# pick a random seed
start = numpy.random.randint(0, len(dataX)-1)
pattern = dataX[start]
print "Seed:"
print "\"", ''.join([int_to_char[value] for value in pattern]), "\""
# generate characters
for i in range(1000):
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(n_vocab)
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	sys.stdout.write(result)
	pattern.append(index)
	pattern = pattern[1:len(pattern)]
print "\nDone."</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-38">38</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-39">39</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-40">40</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-41">41</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-42">42</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-43">43</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-44">44</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-45">45</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-46">46</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-47">47</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-48">48</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-49">49</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-50">50</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-51">51</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-52">52</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-53">53</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-54">54</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-55">55</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-56">56</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-57">57</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-58">58</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-59">59</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-60">60</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-61">61</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-62">62</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-63">63</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-64">64</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef2536065378-65">65</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-1"><span class="crayon-p"># Load LSTM network and generate text</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-2"><span class="crayon-e">import </span><span class="crayon-e">sys</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-3"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np</span><span class="crayon-sy">_</span>utils</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-10"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-11"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-12"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-o">=</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-13"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-14"><span class="crayon-p"># create mapping of unique chars to integers, and a reverse mapping</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-15"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-16"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-17"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-18"><span class="crayon-p"># summarize the loaded data</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-19"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-20"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-21"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-22"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">_</span>vocab</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-23"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-24"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-25"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-26"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-27"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-28"><span class="crayon-h">	</span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-29"><span class="crayon-h">	</span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-30"><span class="crayon-h">	</span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-31"><span class="crayon-h">	</span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-32"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-33"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">_</span>patterns</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-34"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-35"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-36"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-37"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-38"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-39"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-40"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-41"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-45"><span class="crayon-p"># load the network weights</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-46"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"weights-improvement-19-1.9435.hdf5"</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-47"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">load_weights</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-48"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-49"><span class="crayon-p"># pick a random seed</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-50"><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-51"><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">[</span><span class="crayon-v">start</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-52"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Seed:"</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-53"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-54"><span class="crayon-p"># generate characters</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-55"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-56"><span class="crayon-h">	</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-57"><span class="crayon-h">	</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-58"><span class="crayon-h">	</span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-59"><span class="crayon-h">	</span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-60"><span class="crayon-h">	</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-61"><span class="crayon-h">	</span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-62"><span class="crayon-h">	</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">stdout</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-63"><span class="crayon-h">	</span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-64"><span class="crayon-h">	</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef2536065378-65"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\nDone."</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0022 seconds] -->
<p>Running this example first outputs the selected random seed, then each character as it is generated.</p>
<p><strong>Note</strong>: Your <a href="https://machinelearningmastery.com/different-results-each-time-in-machine-learning/">results may vary</a> given the stochastic nature of the algorithm or evaluation procedure, or differences in numerical precision. Consider running the example a few times and compare the average outcome.</p>

<p>For example, below are the results from one run of this text generator. The random seed was:</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeef3100304590" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">be no mistake about it: it was neither more nor less than a pig, and she
felt that it would be quit</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef3100304590-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef3100304590-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef3100304590-1">be no mistake about it: it was neither more nor less than a pig, and she</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef3100304590-2">felt that it would be quit</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The generated text with the random seed (cleaned up for presentation) was:</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeef4610954734" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">be no mistake about it: it was neither more nor less than a pig, and she
felt that it would be quit e aelin that she was a little want oe toiet
ano a grtpersent to the tas a little war th tee the tase oa teettee
the had been tinhgtt a little toiee at the cadl in a long tuiee aedun
thet sheer was a little tare gereen to be a gentle of the tabdit  soenee
the gad  ouw ie the tay a tirt of toiet at the was a little 
anonersen, and thiu had been woite io a lott of tueh a tiie  and taede
bot her aeain  she cere thth the bene tith the tere bane to tee
toaete to tee the harter was a little tire the same oare cade an anl ano
the garee and the was so seat the was a little gareen and the sabdit,
and the white rabbit wese tilel an the caoe and the sabbit se teeteer,
and the white rabbit wese tilel an the cade in a lonk tfne the sabdi
ano aroing to tea the was sf teet whitg the was a little tane oo thete
the sabeit  she was a little tartig to the tar tf tee the tame of the
cagd, and the white rabbit was a little toiee to be anle tite thete ofs
and the tabdit was the wiite rabbit, and</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef4610954734-16">16</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-1">be no mistake about it: it was neither more nor less than a pig, and she</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-2">felt that it would be quit e aelin that she was a little want oe toiet</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-3">ano a grtpersent to the tas a little war th tee the tase oa teettee</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-4">the had been tinhgtt a little toiee at the cadl in a long tuiee aedun</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-5">thet sheer was a little tare gereen to be a gentle of the tabdit&nbsp;&nbsp;soenee</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-6">the gad&nbsp;&nbsp;ouw ie the tay a tirt of toiet at the was a little </div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-7">anonersen, and thiu had been woite io a lott of tueh a tiie&nbsp;&nbsp;and taede</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-8">bot her aeain&nbsp;&nbsp;she cere thth the bene tith the tere bane to tee</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-9">toaete to tee the harter was a little tire the same oare cade an anl ano</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-10">the garee and the was so seat the was a little gareen and the sabdit,</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-11">and the white rabbit wese tilel an the caoe and the sabbit se teeteer,</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-12">and the white rabbit wese tilel an the cade in a lonk tfne the sabdi</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-13">ano aroing to tea the was sf teet whitg the was a little tane oo thete</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-14">the sabeit&nbsp;&nbsp;she was a little tartig to the tar tf tee the tame of the</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-15">cagd, and the white rabbit was a little toiee to be anle tite thete ofs</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef4610954734-16">and the tabdit was the wiite rabbit, and</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can note some observations about the generated text.</p>
<ul>
<li>It generally conforms to the line format observed in the original text of less than 80 characters before a new line.</li>
<li>The characters are separated into word-like groups and most groups are actual English words (e.g. “the”, “little” and “was”), but many do not (e.g. “lott”, “tiie” and “taede”).</li>
<li>Some of the words in sequence make sense(e.g. “<em>and the white rabbit</em>“), but many do&nbsp;not (e.g. “<em>wese tilel</em>“).</li>
</ul>
<p>The fact that this character based model of the book produces output like this is very impressive. It gives you a sense of the learning capabilities of LSTM networks.</p>
<p>The results are not perfect. In the next section we look at improving the quality of results by developing a much larger LSTM network.</p>
<h2>Larger LSTM Recurrent Neural Network</h2>
<p>We got results, but not excellent results in the previous section. Now, we can try to improve the quality of the generated text by creating a much larger network.</p>
<p>We will keep the number of memory units the same at 256, but add a second layer.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeef5289005564" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">...
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2]), return_sequences=True))
model.add(Dropout(0.2))
model.add(LSTM(256))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam')</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef5289005564-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef5289005564-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef5289005564-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef5289005564-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef5289005564-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef5289005564-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef5289005564-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef5289005564-8">8</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef5289005564-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef5289005564-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef5289005564-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef5289005564-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef5289005564-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef5289005564-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef5289005564-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef5289005564-8"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We will also change the filename of the checkpointed weights so that we can tell the difference between weights for this network and the previous (by appending&nbsp;the word “bigger” in the filename).</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeef6764862148" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">filepath="weights-improvement-{epoch:02d}-{loss:.4f}-bigger.hdf5"</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef6764862148-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef6764862148-1"><span class="crayon-v">filepath</span><span class="crayon-o">=</span><span class="crayon-s">"weights-improvement-{epoch:02d}-{loss:.4f}-bigger.hdf5"</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Finally, we will increase the number of training epochs from 20 to 50 and decrease the batch size from 128 to 64 to give the network more of an opportunity to be updated and learn.</p>
<p>The full code listing is presented below for completeness.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeef7995050691" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;"># Larger LSTM Network to Generate Text for Alice in Wonderland
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename, 'r', encoding='utf-8').read()
raw_text = raw_text.lower()
# create mapping of unique chars to integers
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))
# summarize the loaded data
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2]), return_sequences=True))
model.add(Dropout(0.2))
model.add(LSTM(256))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam')
# define the checkpoint
filepath="weights-improvement-{epoch:02d}-{loss:.4f}-bigger.hdf5"
checkpoint = ModelCheckpoint(filepath, monitor='loss', verbose=1, save_best_only=True, mode='min')
callbacks_list = [checkpoint]
# fit the model
model.fit(X, y, epochs=50, batch_size=64, callbacks=callbacks_list)</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-38">38</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-39">39</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-40">40</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-41">41</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-42">42</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-43">43</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-44">44</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-45">45</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-46">46</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-47">47</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-48">48</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-49">49</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-50">50</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef7995050691-51">51</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-1"><span class="crayon-p"># Larger LSTM Network to Generate Text for Alice in Wonderland</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np</span><span class="crayon-sy">_</span>utils</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-9"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-10"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-11"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-o">=</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-12"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-13"><span class="crayon-p"># create mapping of unique chars to integers</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-14"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-15"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-16"><span class="crayon-p"># summarize the loaded data</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-17"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-18"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-19"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-20"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">_</span>vocab</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-21"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-22"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-23"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-24"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-25"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-26"><span class="crayon-h">	</span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-27"><span class="crayon-h">	</span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-28"><span class="crayon-h">	</span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-29"><span class="crayon-h">	</span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-30"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-31"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">_</span>patterns</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-32"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-33"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-34"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-35"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-36"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-37"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-38"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-39"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-40"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-45"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-46"><span class="crayon-p"># define the checkpoint</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-47"><span class="crayon-v">filepath</span><span class="crayon-o">=</span><span class="crayon-s">"weights-improvement-{epoch:02d}-{loss:.4f}-bigger.hdf5"</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-48"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-49"><span class="crayon-v">callbacks_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-50"><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef7995050691-51"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-v">callbacks_list</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>Running this example takes some time, at least 700 seconds per epoch.</p>
<p><strong>Note</strong>: Your <a href="https://machinelearningmastery.com/different-results-each-time-in-machine-learning/">results may vary</a> given the stochastic nature of the algorithm or evaluation procedure, or differences in numerical precision. Consider running the example a few times and compare the average outcome.</p>

<p>After running this example you may achieved a loss of about 1.2. For example the best result I achieved from running this model was stored in a checkpoint file with the name:</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeef8475963289" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">weights-improvement-47-1.2219-bigger.hdf5</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeef8475963289-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeef8475963289-1">weights-improvement-47-1.2219-bigger.hdf5</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Achieving a loss of 1.2219 at epoch 47.</p>
<p>As in the previous section, we can use this best model from the run to generate text.</p>
<p>The only change we need to make to the text generation script from the previous section is in the specification of the network topology and from which file to seed the network weights.</p>
<p>The full code listing is provided below for completeness.</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeefd721750474" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;"># Load Larger LSTM network and generate text
import sys
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename, 'r', encoding='utf-8').read()
raw_text = raw_text.lower()
# create mapping of unique chars to integers, and a reverse mapping
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))
int_to_char = dict((i, c) for i, c in enumerate(chars))
# summarize the loaded data
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2]), return_sequences=True))
model.add(Dropout(0.2))
model.add(LSTM(256))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
# load the network weights
filename = "weights-improvement-47-1.2219-bigger.hdf5"
model.load_weights(filename)
model.compile(loss='categorical_crossentropy', optimizer='adam')
# pick a random seed
start = numpy.random.randint(0, len(dataX)-1)
pattern = dataX[start]
print "Seed:"
print "\"", ''.join([int_to_char[value] for value in pattern]), "\""
# generate characters
for i in range(1000):
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(n_vocab)
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	sys.stdout.write(result)
	pattern.append(index)
	pattern = pattern[1:len(pattern)]
print "\nDone."</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-38">38</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-39">39</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-40">40</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-41">41</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-42">42</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-43">43</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-44">44</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-45">45</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-46">46</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-47">47</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-48">48</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-49">49</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-50">50</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-51">51</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-52">52</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-53">53</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-54">54</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-55">55</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-56">56</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-57">57</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-58">58</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-59">59</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-60">60</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-61">61</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-62">62</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-63">63</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-64">64</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-65">65</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-66">66</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefd721750474-67">67</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-1"><span class="crayon-p"># Load Larger LSTM network and generate text</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-2"><span class="crayon-e">import </span><span class="crayon-e">sys</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-3"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np</span><span class="crayon-sy">_</span>utils</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-10"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-11"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-12"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-o">=</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-13"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-14"><span class="crayon-p"># create mapping of unique chars to integers, and a reverse mapping</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-15"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-16"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-17"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-18"><span class="crayon-p"># summarize the loaded data</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-19"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-20"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-21"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-22"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">_</span>vocab</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-23"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-24"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-25"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-26"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-27"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-28"><span class="crayon-h">	</span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-29"><span class="crayon-h">	</span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-30"><span class="crayon-h">	</span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-31"><span class="crayon-h">	</span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-32"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-33"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">_</span>patterns</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-34"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-35"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-36"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-37"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-38"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-39"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-40"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-41"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-45"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-46"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-47"><span class="crayon-p"># load the network weights</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-48"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"weights-improvement-47-1.2219-bigger.hdf5"</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-49"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">load_weights</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-50"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-51"><span class="crayon-p"># pick a random seed</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-52"><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-53"><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">[</span><span class="crayon-v">start</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-54"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Seed:"</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-55"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-56"><span class="crayon-p"># generate characters</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-57"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-58"><span class="crayon-h">	</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-59"><span class="crayon-h">	</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-60"><span class="crayon-h">	</span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-61"><span class="crayon-h">	</span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-62"><span class="crayon-h">	</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-63"><span class="crayon-h">	</span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-64"><span class="crayon-h">	</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">stdout</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-65"><span class="crayon-h">	</span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-66"><span class="crayon-h">	</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefd721750474-67"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\nDone."</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
<p>One example of running this text generation script&nbsp;produces the&nbsp;output below.</p>
<p><strong>Note</strong>: Your <a href="https://machinelearningmastery.com/different-results-each-time-in-machine-learning/">results may vary</a> given the stochastic nature of the algorithm or evaluation procedure, or differences in numerical precision. Consider running the example a few times and compare the average outcome.</p>

<p>The randomly chosen seed text was:</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeefe584904787" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code" style="display: none;"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">d herself lying on the bank, with her
head in the lap of her sister, who was gently brushing away s</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefe584904787-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeefe584904787-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeefe584904787-1">d herself lying on the bank, with her</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeefe584904787-2">head in the lap of her sister, who was gently brushing away s</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The generated text with the seed (cleaned up for presentation) was :</p><!-- Urvanov Syntax Highlighter v2.8.14 -->

		<div id="urvanov-syntax-highlighter-5f6dd354aeeff204165047" class="urvanov-syntax-highlighter-syntax crayon-theme-classic urvanov-syntax-highlighter-font-monaco urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button urvanov-syntax-highlighter-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-plain-button" title="Toggle Plain Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-wrap-button" title="Toggle Line Wrap"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-expand-button" title="Expand Code"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-copy-button" title="Copy"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div><div class="crayon-button urvanov-syntax-highlighter-popup-button" title="Open Code In New Window"><div class="urvanov-syntax-highlighter-button-icon" style="background-size: 48px 128px; background-image: url(&quot;https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/urvanov-syntax-highlighter/css/images/toolbar/buttons@2x.png&quot;);"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="urvanov-syntax-highlighter-plain-wrap"><textarea wrap="soft" class="urvanov-syntax-highlighter-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">herself lying on the bank, with her
head in the lap of her sister, who was gently brushing away
so siee, and she sabbit said to herself and the sabbit said to herself and the sood
way of the was a little that she was a little lad good to the garden,
and the sood of the mock turtle said to herself, 'it was a little that
the mock turtle said to see it said to sea it said to sea it say it
the marge hard sat hn a little that she was so sereated to herself, and
she sabbit said to herself, 'it was a little little shated of the sooe
of the coomouse it was a little lad good to the little gooder head. and
said to herself, 'it was a little little shated of the mouse of the
good of the courte, and it was a little little shated in a little that
the was a little little shated of the thmee said to see it was a little
book of the was a little that she was so sereated to hare a little the
began sitee of the was of the was a little that she was so seally and
the sabbit was a little lad good to the little gooder head of the gad
seared to see it was a little lad good to the little good</textarea></div>
			<div class="urvanov-syntax-highlighter-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-5f6dd354aeeff204165047-16">16</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-1">herself lying on the bank, with her</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-2">head in the lap of her sister, who was gently brushing away</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-3">so siee, and she sabbit said to herself and the sabbit said to herself and the sood</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-4">way of the was a little that she was a little lad good to the garden,</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-5">and the sood of the mock turtle said to herself, 'it was a little that</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-6">the mock turtle said to see it said to sea it said to sea it say it</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-7">the marge hard sat hn a little that she was so sereated to herself, and</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-8">she sabbit said to herself, 'it was a little little shated of the sooe</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-9">of the coomouse it was a little lad good to the little gooder head. and</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-10">said to herself, 'it was a little little shated of the mouse of the</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-11">good of the courte, and it was a little little shated in a little that</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-12">the was a little little shated of the thmee said to see it was a little</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-13">book of the was a little that she was so sereated to hare a little the</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-14">began sitee of the was of the was a little that she was so seally and</div><div class="crayon-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-15">the sabbit was a little lad good to the little gooder head of the gad</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-5f6dd354aeeff204165047-16">seared to see it was a little lad good to the little good</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that generally there are fewer spelling mistakes and the text looks more realistic, but is still quite nonsensical.</p>
<p>For example the same phrases get repeated again and again like “<em>said to herself</em>” and “<em>little</em>“. Quotes are opened&nbsp;but not closed.</p>
<p>These are better results but there is still a lot of room for improvement.</p>
<h2>10 Extension&nbsp;Ideas to Improve the Model</h2>
<p>Below are 10 ideas that may&nbsp;further improve the model that you could experiment with are:</p>
<ul>
<li>Predict fewer than 1,000 characters as output for a given seed.</li>
<li>Remove all punctuation from the source text, and therefore from the models’ vocabulary.</li>
<li>Try a one hot encoded&nbsp;for the input sequences.</li>
<li>Train the model on padded sentences rather than random sequences of characters.</li>
<li>Increase the number of training epochs to 100 or many hundreds.</li>
<li>Add dropout to the visible input&nbsp;layer and consider&nbsp;tuning the dropout percentage.</li>
<li>Tune the batch size, try a batch size of 1&nbsp;as a (very slow) baseline and larger sizes from there.</li>
<li>Add more memory units to the layers and/or more layers.</li>
<li>Experiment with scale factors (<a href="https://en.wikipedia.org/wiki/Softmax_function#Reinforcement_learning">temperature</a>) when&nbsp;interpreting the prediction probabilities.</li>
<li>Change the LSTM layers to be “stateful”&nbsp;to maintain state across batches.</li>
</ul>
<p>Did you try any of these extensions? Share your results in the comments.</p>
<h2>Resources</h2>
<p>This character text model is a popular way for generating text using recurrent neural networks.</p>
<p>Below are some more resources and tutorials on the topic if you are interested in going deeper. Perhaps the most popular is the tutorial by Andrej Karpathy titled “<a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">The Unreasonable Effectiveness of Recurrent Neural Networks</a>“.</p>
<ul>
<li><a href="http://www.cs.utoronto.ca/~ilya/pubs/2011/LANG-RNN.pdf">Generating Text with Recurrent Neural Networks</a>&nbsp;[pdf], 2011</li>
<li><a href="https://github.com/fchollet/keras/blob/master/examples/lstm_text_generation.py">Keras code example of LSTM for text generation</a>.</li>
<li><a href="https://github.com/Lasagne/Recipes/blob/master/examples/lstm_text_generation.py">Lasagne code example of LSTM for text generation</a>.</li>
<li><a href="http://mxnetjl.readthedocs.io/en/latest/tutorial/char-lstm.html">MXNet tutorial for using an LSTM for text generation</a>.</li>
<li><a href="https://larseidnes.com/2015/10/13/auto-generating-clickbait-with-recurrent-neural-networks/">Auto-Generating Clickbait With Recurrent Neural Networks</a>.</li>
</ul>
<h2>Summary</h2>
<p>In this post you discovered how you&nbsp;can develop an LSTM recurrent neural network for text generation in Python with the Keras deep learning library.</p>
<p>After reading this post you know:</p>
<ul>
<li>Where to download the ASCII text for classical books for free that you can use for training.</li>
<li>How to train an LSTM network on text sequences and how to use the trained network to generate new sequences.</li>
<li>How to develop stacked LSTM networks and lift the performance of the model.</li>
</ul>
<p>Do you have any questions about text generation with LSTM networks or about this post? Ask your questions in the comments below and I will do my best to answer them.</p>
<div class="widget_text awac-wrapper" id="custom_html-70"><div class="widget_text awac widget custom_html-70"><div class="textwidget custom-html-widget"><div style="text-align: center;">
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<a href="/deep-learning-for-nlp/" rel="nofollow"><img style="border: 0;" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" alt="Deep Learning for Natural Language Processing" align="left"></a>
<h4>Develop Your Own Text models in Minutes</h4>
<p>...with just a few lines of python code</p>

<p>Discover how in my new Ebook:<br>
<a href="/deep-learning-for-nlp/" rel="nofollow">Deep Learning for Natural Language Processing</a></p>

<p>It provides <strong>self-study tutorials</strong> on topics like:<br>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more...</p>

<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>

<a href="/deep-learning-for-nlp/" class="woo-sc-button  red"><span class="woo-">See What's Inside</span></a>
<div class="woo-sc-hr"></div>
</div></div></div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-2964 post  simplesocialbuttons-inline-no-animation simplesocialbuttons-inline-in">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=Text+Generation+With+LSTM+Recurrent+Neural+Networks+in+Python+with+Keras&amp;url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" rel="nofollow" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72"><path fill="none" d="M0 0h72v72H0z"></path><path class="icon" fill="#fff" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
		<button class="ssb_fbshare-icon" target="_blank" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="_1pbq" color="#ffffff"><path fill="#ffffff" fill-rule="evenodd" class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z"></path></svg></span>
						<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"> <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="15px" height="14.1px" viewBox="-301.4 387.5 15 14.1" enable-background="new -301.4 387.5 15 14.1" xml:space="preserve"> <g id="XMLID_398_"> <path id="XMLID_399_" fill="#FFFFFF" d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z"></path> <path id="XMLID_400_" fill="#FFFFFF" d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z"></path> <path id="XMLID_401_" fill="#FFFFFF" d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z"></path> </g> </svg> </span>
						<span class="simplesocialtxt">Share</span> </button>
</div>
	</section><!-- /.entry -->
	<div class="fix"></div>
<aside id="post-author">
	<div class="profile-image"><img alt="" src="https://secure.gravatar.com/avatar/a0942b56b07831ac15d4a168a750e34a?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a0942b56b07831ac15d4a168a750e34a?s=160&amp;d=mm&amp;r=g 2x" class="avatar avatar-80 photo" height="80" width="80" loading="lazy"></div>
	<div class="profile-content">
		<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
			<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span>			</a>
		</div><!--#profile-link-->
			</div>
	<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article>